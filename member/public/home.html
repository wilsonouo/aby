<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="CSS/reset.css">
    <link rel="stylesheet" href="CSS/sidebar.css">
    <link rel="stylesheet" href="CSS/form.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.20/dist/sweetalert2.all.min.js"></script>
    <script src="Javascript/data.js"></script>
    <script src="Javascript/login_verify.js"></script>
    <script src="Javascript/form.js"></script>
    <script src="Javascript/shareoutDate.js"></script>

    <!-- æ ¸å¿ƒï¼šTocas UI -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocas/4.2.4/tocas.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocas/4.2.4/tocas.min.js"></script>

    <!-- å­—é«”ï¼šNoto Sans TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" />
</head>

<style>
    body {
        background-color: #eec4c4;
        height: 1229px; /* è¨­ç½®å…§å®¹çš„é«˜åº¦ç‚ºè¦–çª—é«˜åº¦ */
    }
    
    header {
        background-color: #c42a2a;
        border-bottom: #fff;
        height: 530px;
    }

    .ts-tab{
        line-height: 100px;
        font-size: 30px;
    }

    .first {
        background-color: #c42a2a;
    }

    .background_img {
        position: absolute;
        bottom: 0; 
        left: 0; 
        width: 100%;
        height: 450px; /* è¨­å®šæ‚¨æƒ³è¦çš„é«˜åº¦ï¼Œå¯ä»¥éš¨æ„èª¿æ•´ */
        background-image: url(bg.jpg);
        background-position: center;
        background-color: #E0964D;
        background-repeat: no-repeat; 
        background-size: contain; 
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    }

</style>

<body>
    <header>
        <div class="ts-tab is-fluid">
            <a class="item" onclick="toggleSidebar(event)">
                <span class="ts-icon is-list-icon"></span>
                é …ç›®
            </a>
            <a class="item" onclick="login()">
                <span class="ts-icon is-chart-line-icon"></span>
                <span class="login_state">ç™»å…¥</span>
            </a>
            <a class="item">
                <span class="ts-icon is-scroll-icon"></span>
                é¦–é 
            </a>
            <a class="item">
                <span class="ts-icon is-scroll-icon"></span>
                è¯çµ¡æˆ‘å€‘
            </a>
        </div>
        <div class="background_img"></div>
    </header>
    
    <div class="sidebar" >
        <table>
            <tbody>
            </tbody>
        </table>
    </div>
    
    <!--ä¸»è¦è¡¨å–®ï¼Œåˆå§‹ç‚ºéš±è—ç‹€æ…‹-->
    <section class="form">    
        <div class="form-container">
            <form id="UserData">
                <label for="gender">æ€§åˆ¥ï¼š</label>
                <select id="gender" name="gender">
                    <option value="male">ç”·æ€§</option>
                    <option value="female">å¥³æ€§</option>
                    <option value="other">å…¶ä»–</option>
                </select>

                <label>èˆˆè¶£ï¼š</label>
                <div class="interest-buttons">
                    <button type="button" value="reading" onclick="click_entertainment(event)">å®¤å…§å¨›æ¨‚</button>
                    <button type="button" value="sports" onclick="click_sports(event)">æˆ¶å¤–é‹å‹•</button>
                    <button type="button" value="music" onclick="click_art(event)">è—è¡“</button>
                    <button type="button" value="travel" onclick="click_other(event)">å…¶ä»–èˆˆè¶£</button>
                    <button type="button" value="travel" onclick="click_place(event)">å–œå¥½çš„æ—…éŠåœ°é»</button>
                </div>

                <button type="submit" style="margin:50px 20px 0px 0px; background-color:chocolate" onclick="saveData(event)">æäº¤</button>
                <button type="submit" style="margin-top:50px; background-color:chocolate" onclick="cancelForm(event)">å–æ¶ˆ</button>
            </form>
        </div>
        <button type="button" onclick="showFormContainer()" id="showForm">é»æ“Šé€™è£¡å¡«å¯«è³‡æ–™ </button>
    </section>
    <!--æ¬¡è¦è¡¨å–®ï¼Œåˆå§‹ç‚ºéš±è—ç‹€æ…‹-->
    <section class="_subForm">
        <!-- å½ˆå‡ºçš„å°è¡¨å–® 1-->
        <div id="entertainmentForm" class="popup-form" style="display: none;">
            <h2>è«‹é¸æ“‡ï¼š</h2>
            <label class="ts-checkbox">
                <input type="checkbox" value="darts"/>
                å°„é£›é¢
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="boardgames"/>
                æ¡Œä¸ŠéŠæˆ²
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="cooking"/>
                çƒ¹é£ª
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="chess"/>
                è¥¿æ´‹æ£‹
            </label>
            <!-- å…¶ä»–å¨›æ¨‚é …ç›®æŒ‰éˆ• -->
        </div>
        <!-- å½ˆå‡ºçš„å°è¡¨å–® 2-->
        <div id="sportsForm" class="popup-form" style="display: none;">
            <h2>è«‹é¸æ“‡ï¼š</h2>
            <label class="ts-checkbox">
                <input type="checkbox" value="yoga"/>
                ç‘œçˆ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="basketball"/>
                ç±ƒçƒ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="baseball"/>
                æ£’çƒ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="boxing"/>
                æ‹³æ“Š
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="billiards"/>
                æ’çƒ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="climbing"/>
                æ”€å²©
            </label>
            <!-- å…¶ä»–å¨›æ¨‚é …ç›®æŒ‰éˆ• -->
        </div>
        <!-- å½ˆå‡ºçš„å°è¡¨å–® 3-->
        <div id="artForm" class="popup-form" style="display: none;">
            <h2>è«‹é¸æ“‡ï¼š</h2>
            <label class="ts-checkbox">
                <input type="checkbox" value="drawing"/>
                ç¹ªç•«
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="calligraphy"/>
                æ›¸æ³•
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="writing"/>
                é–±è®€/å¯«ä½œ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="dancing"/>
                èˆè¹ˆ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="crafts"/>
                æ‰‹å·¥è—
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="drama"/>
                æˆ²åŠ‡æ¬£è³
            </label>
            <!-- å…¶ä»–å¨›æ¨‚é …ç›®æŒ‰éˆ• -->
        </div>
        <!-- å½ˆå‡ºçš„å°è¡¨å–® 5-->
        <div id="otherForm" class="popup-form" style="display: none;">
            <h2>è«‹é¸æ“‡ï¼š</h2>
            <label class="ts-checkbox">
                <input type="checkbox" value="driving"/>
                å…œé¢¨
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="debate"/>
                è¾¯è«–
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="cosplay"/>
                cosplay
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="bridge"/>
                æ©‹ç‰Œ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="birdwatching"/>
                è³é³¥
            </label>
            <!-- å…¶ä»–å¨›æ¨‚é …ç›®æŒ‰éˆ• -->
        </div>
        <!-- å½ˆå‡ºçš„å°è¡¨å–® 4-->
        <div id="placeForm" class="popup-form" style="display: none;">
            <h2>è«‹é¸æ“‡ï¼š</h2>
            <label class="ts-checkbox">
                <input type="checkbox" value="aquarium"/>
                æ°´æ—é¤¨
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="museum"/>
                åšç‰©é¤¨
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="camping"/>
                éœ²ç‡Ÿ
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="beach"/>
                æ²™ç˜
            </label>
            <label class="ts-checkbox">
                <input type="checkbox" value="zoo"/>
                å‹•ç‰©åœ’
            </label>
            <!-- å…¶ä»–å¨›æ¨‚é …ç›®æŒ‰éˆ• -->
        </div>
    </section>
    
    <main>
        <div class="container" style="margin-top: 30px;">
            <img src="drinking water-pana.svg" style="width: 200px;" alt="">
            <h1>ç†±æ„›éš±ç§ï¼ŸABYæ–¹å¼è®“æ‚¨å®‰å¿ƒï¼ğŸ”’</h1>
            <p>æ­¡è¿ä¾†åˆ°æœ¬ç¶²ç«™ï¼Œæˆ‘å€‘æ·±çŸ¥ä¿è­·æ‚¨çš„å€‹äººè³‡æ–™æ˜¯æœ€é‡è¦çš„äº‹æƒ…ä¹‹ä¸€ã€‚ç‚ºäº†ç¢ºä¿æ‚¨çš„éš±ç§å®Œå…¨å¾—åˆ°ä¿éšœï¼Œæˆ‘å€‘æ¡ç”¨æœ€å…ˆé€²çš„ABYæŠ€è¡“ï¼Œè®“æ‚¨çš„å€‹è³‡åƒé‘½çŸ³èˆ¬å …ä¸å¯æ‘§ï¼</p>
            <h2>ABYæŠ€è¡“çš„å¼·å¤§ä¹‹è™•</h2>
            <ul>
                <li>1. åŒ¿ååŠ å¯† - æˆ‘å€‘çš„ABYæ–¹å¼ç¢ºä¿æ‚¨çš„å€‹äººèº«ä»½å’Œæ•æ„Ÿè³‡æ–™çµ•å°åŒ¿åå’ŒåŠ å¯†ã€‚æ‚¨çš„è³‡æ–™åªæœƒåœ¨å¿…è¦æ™‚è¢«ä½¿ç”¨ï¼Œç¢ºä¿æ‚¨çš„éš±ç§ä¸€çµ²ä¸è‹Ÿã€‚</li>
                <li>2. å®Œå–„çš„å®‰å…¨æªæ–½ - æˆ‘å€‘ä»¥æœ€é«˜æ¨™æº–ä¾†ä¿è­·æ‚¨çš„è³‡æ–™ã€‚æ‰€æœ‰æ•¸æ“šå‚³è¼¸éƒ½å—åˆ°åš´æ ¼çš„ä¿è­·ï¼Œé˜²æ­¢ä»»ä½•æœªæˆæ¬Šçš„è¨ªå•æˆ–æ´©æ¼ã€‚</li>
                <li>3. èˆˆè¶£ç›¸ä¼¼åº¦æ¸¬è©¦ - åœ¨æ­£å¼äº¤è«‡å‰ï¼Œè®“æˆ‘å€‘ç‚ºæ‚¨æä¾›ä¸€å€‹èˆˆè¶£ç›¸ä¼¼åº¦æ¸¬è©¦ã€‚é€™å€‹æœ‰è¶£çš„æ¸¬è©¦æœƒå¹«åŠ©æˆ‘å€‘æ‰¾åˆ°å’Œæ‚¨å¿—åŒé“åˆçš„äººï¼Œä¸åƒ…ç¯€çœæ‚¨çš„æ™‚é–“ï¼Œä¹Ÿæé«˜äº†äº¤æµçš„å¯èƒ½æ€§ã€‚</li>
            </ul>
            <h2>èˆ‡æˆ‘å€‘ä¸€èµ·æ¢ç´¢æœªçŸ¥ ğŸš€</h2>
            <p>æ‚¨ä¸éœ€æ“”å¿ƒè³‡æ–™æ´©æ¼æˆ–ä¾µçŠ¯éš±ç§çš„å•é¡Œï¼Œæˆ‘å€‘çš„ABYæ–¹å¼è®“æ‚¨åœ¨é€™å€‹ç¶²ç«™ä¸Šæ”¾å¿ƒæ¢ç´¢ã€‚è®“æˆ‘å€‘å¹«æ‚¨æ‰¾åˆ°å¿—åŒé“åˆçš„å¤¥ä¼´ï¼Œç„¡è«–æ˜¯äº¤å‹ã€èŠå¤©ã€é‚„æ˜¯å…±åŒæ„›å¥½ï¼Œé€™è£¡éƒ½æœ‰ç„¡é™å¯èƒ½ï¼</p>
            <h3>ç«‹å³é–‹å§‹ï¼Œå„ªé›…åœ°ä¿è­·æ‚¨çš„éš±ç§ï¼Œèˆ‡å¿ƒå„€çš„äººä¸€åŒå±•é–‹ç¾å¦™çš„å°è©±æ—…ç¨‹å§ï¼ğŸ’¡</h3>
        </div>
    </main>

    <div id="loginFormContainer"></div>

    <script>

        /* begin   the code inside need to be active each update*/

        // Get all <td> elements inside the sidebar
        const tdElements = document.querySelectorAll('.sidebar td');

        // Add event listener to each <td> element
        tdElements.forEach(td => {
            td.addEventListener('click', function() {
                // Get the person's name from the clicked <td>
                let tdContent = this.innerText.trim();
                
                personName = tdContent.replace('person', '').trim();

                Swal.fire({
                    icon: 'warning', // Set the icon type (info, success, warning, error)
                    title: 'ä½ é¸ä¸­äº†:', // Set the title of the popup
                    text: personName, // Set the content of the popup
                    showCancelButton: true,
                    confirmButtonText: 'ç¢ºå®šé…å°', // Set the text of the confirmation button
                    confirmButtonColor: '#45A049',
                    cancelButtonColor: '#d33',
                    cancelButtonText: 'å–æ¶ˆé…å°',
                }).then((result) => {
                    if (!result.isConfirmed) {
                        Swal.fire(
                        'å–æ¶ˆ!',
                        'ä½ å–æ¶ˆäº†é…å°',
                        'success'
                        )
                    } else {
                        Swal.fire(
                        'ä½ ç™¼é€äº†é…å°è«‹æ±‚!',
                        'å¾µè©¢å°æ–¹æ˜¯å¦é¡˜æ„é…å°..',
                        'success'
                        )
                    }
                });
            });
        });

        function toggleSidebar(e) {
            /*querySelectorå›å‚³åŒ¹é…classçš„ç¬¬ä¸€å€‹ç¯€é»*/
            const sidebar = document.querySelector('.sidebar')

            if (sidebar.style.marginLeft === '' || sidebar.style.marginLeft === '-250px') {
                e.target.style.backgroundColor = ""
                sidebar.style.marginLeft = '0'
            } else {
                e.target.style.backgroundColor = "brown"
                sidebar.style.marginLeft = '-250px'
            }
        }

        let formData = []

        // document.bodyçš„é»æ“Šäº‹ä»¶è™•ç†ç¨‹åº=>ç”¨æ–¼éš±è—æ¬¡è¦è¡¨å–®subform
        function bodyClickHandler(event) {
            console.log('bodyClickHandler');
            const _subForm = document.querySelector('._subForm');
            // æª¢æŸ¥é»æ“Šçš„å…ƒç´ æ˜¯å¦åœ¨_subFormå…§æˆ–æ˜¯showFormæŒ‰éˆ•ï¼Œå¦‚æœä¸æ˜¯å‰‡éš±è—_subForm
            if (!_subForm.contains(event.target) && event.target.id !== 'showForm') {
                hide_subForm();
            }
        }
        //åˆ¤æ–·ç•¶å‰çš„ç™»å…¥ç‹€æ…‹
        document.addEventListener('DOMContentLoaded', function() {
        // æª¢æŸ¥ sessionStorage ä¸­æ˜¯å¦æœ‰ yourtoken
            const token = sessionStorage.getItem('yourtoken');
            const name = sessionStorage.getItem('yourName');
            const accountIcon = document.querySelector('span.login_state');


            if (token) {
                // å·²ç™»å…¥ç‹€æ…‹ï¼Œå°‡æ–‡å­—è¨­ç½®ç‚º "ç™»å…¥æˆåŠŸ"
                accountIcon.textContent = ' ç™»å…¥æˆåŠŸ ';
                const form = document.getElementsByClassName('form')[0];
                form.style.display = 'block';

                // å¦‚æœæœ‰ username åƒæ•¸ï¼Œå°‡å¸³è™Ÿåç¨±åŠ å…¥åˆ° sidebar
                fetch('/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'token': token
                    }
                })
                .then(response => {
                    // æ£€æŸ¥ HTTP å“åº”çŠ¶æ€ç 
                    if (response.ok) {
                    // ä½¿ç”¨ .json() æ–¹æ³•è§£æ JSON æ•°æ®
                        console.log('57');
                        return response.json();
                    } else {
                    // å¤„ç†é”™è¯¯æƒ…å†µ
                        console.log('58');
                        throw new Error('Failed to fetch data');
                    }
                })
                .then(data => {
                    console.log('60');
                    // åœ¨è¿™é‡Œå¯ä»¥è®¿é—®åç«¯è¿”å›çš„ JSON æ•°æ®
                    for (const item of data['member']) {
                        add_user_into_sidebar(item);
                    }
                    
                    // è¿™é‡Œå¯ä»¥è¿›è¡Œåç»­æ“ä½œï¼Œæ ¹æ®ä½ çš„éœ€æ±‚æ¥å¤„ç†æ•°æ®
                })
                .catch(error => {
                    console.log('61');
                    // æ•è·å¹¶å¤„ç†è¯·æ±‚æˆ–è§£æ JSON æ•°æ®æ—¶çš„é”™è¯¯
                    console.error('Error:', error);
                });
                
            } else {
                // æœªç™»å…¥ç‹€æ…‹ï¼Œå°‡æ–‡å­—è¨­ç½®ç‚º "ç™»å…¥"
                accountIcon.textContent = ' ç™»å…¥ ';
                const form = document.getElementsByClassName('form')[0];
                form.style.display = 'none';
                clear_sidebar_buttons();
            }
        });

        function clear_sidebar_buttons() {
            // è·å– sidebar ä¸­çš„ table å…ƒç´ 
            const sidebarTable = document.querySelector('.sidebar table');
            
            // ä» table å…ƒç´ ä¸­åˆ é™¤æ‰€æœ‰å­å…ƒç´ 
            while (sidebarTable.firstChild) {
                sidebarTable.removeChild(sidebarTable.firstChild);
            }
        }
    </script>
</body>
</html>

